@page "/test-db"
@using GestionBudgétaire.Data
@using GestionBudgétaire.Data.Entities.Database
@using GestionBudgétaire.Data.Services.ToBeRemoved

@inject TestService TestService

@* Page de test permet de contrôler l'accès à la base de données *@'

<h3>Données de la table Dialogue</h3>

@if (dialogues == null)
{
    <p>Chargement des données...</p>
}
else if (!dialogues.Any())
{
    <p>Aucune donnée trouvée.</p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>DG_CODE</th>
                <th>FOURNISSEUR</th>
                <th>LIBELLE_DU_MARCHE</th>
                <th>MONTANT_TTC</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in dialogues)
            {
                <tr>
                    <td>@item.DG_CODE</td>
                    <td>@item.FOURNISSEUR</td>
                    <td>@item.LIBELLE_DU_MARCHE</td>
                    <td>@item.MONTANT_TTC</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private List<Dialogue>? dialogues;

    protected override async Task OnInitializedAsync()
    {
        Console.WriteLine($"OnInitializedAsync test.razor - /test-db");
        try
        {
            dialogues = await TestService.GetDialoguesAsync();
            // Limite l'affichage à 10 lignes
            dialogues = dialogues.Take(10).ToList();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Erreur lors de la récupération des données : {ex.Message}");
        }
    }
}